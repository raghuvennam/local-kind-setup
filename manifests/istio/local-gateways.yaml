apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: admin-gateway
  namespace: istio-ingress
  labels:
    gateway: admin-gateway
spec:
  selector:
    app: istio-ingressgateway
    istio: ingressgateway
  servers:
  - hosts:
    - admin.internal
    port:
      name: http
      number: 80
      protocol: HTTP
  - hosts:
    - admin.internal
    port:
      name: https
      number: 443
      protocol: HTTPS
    tls:
      mode: SIMPLE
      credentialName: internal-cert
      minProtocolVersion: TLSV1_2
---
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: api-gateway
  namespace: istio-ingress
  labels:
    gateway: api-gateway
spec:
  selector:
    app: istio-ingressgateway
    istio: ingressgateway
  servers:
  - hosts:
    - api.internal
    port:
      name: http
      number: 80
      protocol: HTTP
  - hosts:
    - api.internal
    port:
      name: https
      number: 443
      protocol: HTTPS
    tls:
      mode: SIMPLE
      credentialName: internal-cert
      minProtocolVersion: TLSV1_2
---
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: web-gateway
  namespace: istio-ingress
  labels:
    gateway: web-gateway
spec:
  selector:
    app: istio-ingressgateway
    istio: ingressgateway
  servers:
  - hosts:
    - web.internal
    port:
      name: http
      number: 80
      protocol: HTTP
  - hosts:
    - web.internal
    port:
      name: https
      number: 443
      protocol: HTTPS
    tls:
      mode: SIMPLE
      credentialName: internal-cert
      minProtocolVersion: TLSV1_2
---
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: allow-gateway-ingress
  namespace: istio-ingress
spec:
  action: ALLOW
  rules:
  - from:
    - source:
        ipBlocks:
        - 0.0.0.0/0
  selector:
    matchLabels:
      app: istio-ingressgateway
      istio: ingressgateway
